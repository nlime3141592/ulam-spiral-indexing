# ulam-spiral-indexing

### 개요
본 알고리즘 개발의 시작은 2차원 정수 좌표를 1차원 정수로 Hashing하기 위한 방법을 고민하는 것에서 출발한다.

### 기존 연구
- Cantor Pairing Function

$$
z=\pi(x,y)=\frac{(x+y)(x+y+1)}{2}+y
$$

- Ulam Spiral

자연수를 Square Spiral 형태로 써내려가며 소수(Prime Number)를 마킹한 Prime Number Map

### 동작 원리

#### 2D Point to 1D Index
- ${x}\ge{y}$ 영역에서의 값 변화

$2x(2x-1)$ (또는 $2y(2y-1)$, $\because x=y$)

- ${x}<{y}$ 영역에서의 값 변화

$2x(2x-1)$ (또는 $2y(2y-1)$, $\because x=y$)

#### 1D Index to 2D Point

- ${S(n,n)}\le{i}\le{S(-n,-n)}$

${-1+\sqrt{4i+1}}\le{4n}\le{1+\sqrt{4i+1}}$

- ${S(-n,-n)}\le{i}\le{S(n+1,n+1)}$

$max(0,{-3+\sqrt{4i+1}})\le{4n}\le{1+\sqrt{4i+1}}$

### 구현
#### 2D Point to 1D Index
- Code Implementaiton (Python)
```python
def ToIndex(x, y):
    transposedFlag = 1

    if x > y:
        t = x
        x = y
        y = t
        transposedFlag = -1

    if x + y > 0:
        a = y + y
        a = a * (a - 1)
        return a + transposedFlag * (y - x)
    else:
        b = x + x
        b = b * (b - 1)
        return b + transposedFlag * (x - y)

def PrintSpiralIndices(min = -4, max = -4):
    for y in range(max, min - 1, -1):
        for x in range(min, max + 1):
            index = ToIndex(x, y)
            print("%03d " % (index), end="")
        print("")

PrintSpiralIndices(-6, 6)
```
- Output
```
144 143 142 141 140 139 138 137 136 135 134 133 132 
145 100 099 098 097 096 095 094 093 092 091 090 131 
146 101 064 063 062 061 060 059 058 057 056 089 130 
147 102 065 036 035 034 033 032 031 030 055 088 129 
148 103 066 037 016 015 014 013 012 029 054 087 128 
149 104 067 038 017 004 003 002 011 028 053 086 127 
150 105 068 039 018 005 000 001 010 027 052 085 126 
151 106 069 040 019 006 007 008 009 026 051 084 125 
152 107 070 041 020 021 022 023 024 025 050 083 124 
153 108 071 042 043 044 045 046 047 048 049 082 123 
154 109 072 073 074 075 076 077 078 079 080 081 122 
155 110 111 112 113 114 115 116 117 118 119 120 121 
156 157 158 159 160 161 162 163 164 165 166 167 168
```

#### 1D Index to 2D Point
- Code Implementation (Python)
```python
import math

def ToPoint(i):
    v = math.floor(math.sqrt(4 * i + 1))
    r = v % 4

    if r == 0:
        n = v // 4
        p = ToIndex(-n, -n)
        return (-n, -n + p - i)
    elif r == 1:
        n = (v - 1) // 4
        p = ToIndex(-n, -n)
        return (-n - p + i, -n)
    elif r == 2:
        n = (v - 2) // 4
        p = ToIndex(n + 1, n + 1)
        return (n + 1, n + 1 - p + i)
    else:
        n = (v + 1) // 4
        p = ToIndex(n, n)
        return (n + p - i, n)

def PrintPoints(count = 81):
    for i in range(count):
        (x, y) = ToPoint(i)
        print("i == %d -> (x, y) == (%d, %d)" % (i, x, y))

PrintPoints(169)
```
- Output
```
i == 0 -> (x, y) == (0, 0)
i == 1 -> (x, y) == (1, 0)
i == 2 -> (x, y) == (1, 1)
i == 3 -> (x, y) == (0, 1)
i == 4 -> (x, y) == (-1, 1)
i == 5 -> (x, y) == (-1, 0)
i == 6 -> (x, y) == (-1, -1)
i == 7 -> (x, y) == (0, -1)
i == 8 -> (x, y) == (1, -1)
i == 9 -> (x, y) == (2, -1)
i == 10 -> (x, y) == (2, 0)
i == 11 -> (x, y) == (2, 1)
i == 12 -> (x, y) == (2, 2)
i == 13 -> (x, y) == (1, 2)
i == 14 -> (x, y) == (0, 2)
i == 15 -> (x, y) == (-1, 2)
i == 16 -> (x, y) == (-2, 2)
i == 17 -> (x, y) == (-2, 1)
i == 18 -> (x, y) == (-2, 0)
i == 19 -> (x, y) == (-2, -1)
i == 20 -> (x, y) == (-2, -2)
i == 21 -> (x, y) == (-1, -2)
i == 22 -> (x, y) == (0, -2)
i == 23 -> (x, y) == (1, -2)
i == 24 -> (x, y) == (2, -2)
i == 25 -> (x, y) == (3, -2)
i == 26 -> (x, y) == (3, -1)
i == 27 -> (x, y) == (3, 0)
i == 28 -> (x, y) == (3, 1)
i == 29 -> (x, y) == (3, 2)
i == 30 -> (x, y) == (3, 3)
i == 31 -> (x, y) == (2, 3)
i == 32 -> (x, y) == (1, 3)
i == 33 -> (x, y) == (0, 3)
i == 34 -> (x, y) == (-1, 3)
i == 35 -> (x, y) == (-2, 3)
i == 36 -> (x, y) == (-3, 3)
i == 37 -> (x, y) == (-3, 2)
i == 38 -> (x, y) == (-3, 1)
i == 39 -> (x, y) == (-3, 0)
i == 40 -> (x, y) == (-3, -1)
i == 41 -> (x, y) == (-3, -2)
i == 42 -> (x, y) == (-3, -3)
i == 43 -> (x, y) == (-2, -3)
i == 44 -> (x, y) == (-1, -3)
i == 45 -> (x, y) == (0, -3)
i == 46 -> (x, y) == (1, -3)
i == 47 -> (x, y) == (2, -3)
i == 48 -> (x, y) == (3, -3)
i == 49 -> (x, y) == (4, -3)
i == 50 -> (x, y) == (4, -2)
i == 51 -> (x, y) == (4, -1)
i == 52 -> (x, y) == (4, 0)
i == 53 -> (x, y) == (4, 1)
i == 54 -> (x, y) == (4, 2)
i == 55 -> (x, y) == (4, 3)
i == 56 -> (x, y) == (4, 4)
i == 57 -> (x, y) == (3, 4)
i == 58 -> (x, y) == (2, 4)
i == 59 -> (x, y) == (1, 4)
i == 60 -> (x, y) == (0, 4)
i == 61 -> (x, y) == (-1, 4)
i == 62 -> (x, y) == (-2, 4)
i == 63 -> (x, y) == (-3, 4)
i == 64 -> (x, y) == (-4, 4)
i == 65 -> (x, y) == (-4, 3)
i == 66 -> (x, y) == (-4, 2)
i == 67 -> (x, y) == (-4, 1)
i == 68 -> (x, y) == (-4, 0)
i == 69 -> (x, y) == (-4, -1)
i == 70 -> (x, y) == (-4, -2)
i == 71 -> (x, y) == (-4, -3)
i == 72 -> (x, y) == (-4, -4)
i == 73 -> (x, y) == (-3, -4)
i == 74 -> (x, y) == (-2, -4)
i == 75 -> (x, y) == (-1, -4)
i == 76 -> (x, y) == (0, -4)
i == 77 -> (x, y) == (1, -4)
i == 78 -> (x, y) == (2, -4)
i == 79 -> (x, y) == (3, -4)
i == 80 -> (x, y) == (4, -4)
i == 81 -> (x, y) == (5, -4)
i == 82 -> (x, y) == (5, -3)
i == 83 -> (x, y) == (5, -2)
i == 84 -> (x, y) == (5, -1)
i == 85 -> (x, y) == (5, 0)
i == 86 -> (x, y) == (5, 1)
i == 87 -> (x, y) == (5, 2)
i == 88 -> (x, y) == (5, 3)
i == 89 -> (x, y) == (5, 4)
i == 90 -> (x, y) == (5, 5)
i == 91 -> (x, y) == (4, 5)
i == 92 -> (x, y) == (3, 5)
i == 93 -> (x, y) == (2, 5)
i == 94 -> (x, y) == (1, 5)
i == 95 -> (x, y) == (0, 5)
i == 96 -> (x, y) == (-1, 5)
i == 97 -> (x, y) == (-2, 5)
i == 98 -> (x, y) == (-3, 5)
i == 99 -> (x, y) == (-4, 5)
i == 100 -> (x, y) == (-5, 5)
i == 101 -> (x, y) == (-5, 4)
i == 102 -> (x, y) == (-5, 3)
i == 103 -> (x, y) == (-5, 2)
i == 104 -> (x, y) == (-5, 1)
i == 105 -> (x, y) == (-5, 0)
i == 106 -> (x, y) == (-5, -1)
i == 107 -> (x, y) == (-5, -2)
i == 108 -> (x, y) == (-5, -3)
i == 109 -> (x, y) == (-5, -4)
i == 110 -> (x, y) == (-5, -5)
i == 111 -> (x, y) == (-4, -5)
i == 112 -> (x, y) == (-3, -5)
i == 113 -> (x, y) == (-2, -5)
i == 114 -> (x, y) == (-1, -5)
i == 115 -> (x, y) == (0, -5)
i == 116 -> (x, y) == (1, -5)
i == 117 -> (x, y) == (2, -5)
i == 118 -> (x, y) == (3, -5)
i == 119 -> (x, y) == (4, -5)
i == 120 -> (x, y) == (5, -5)
i == 121 -> (x, y) == (6, -5)
i == 122 -> (x, y) == (6, -4)
i == 123 -> (x, y) == (6, -3)
i == 124 -> (x, y) == (6, -2)
i == 125 -> (x, y) == (6, -1)
i == 126 -> (x, y) == (6, 0)
i == 127 -> (x, y) == (6, 1)
i == 128 -> (x, y) == (6, 2)
i == 129 -> (x, y) == (6, 3)
i == 130 -> (x, y) == (6, 4)
i == 131 -> (x, y) == (6, 5)
i == 132 -> (x, y) == (6, 6)
i == 133 -> (x, y) == (5, 6)
i == 134 -> (x, y) == (4, 6)
i == 135 -> (x, y) == (3, 6)
i == 136 -> (x, y) == (2, 6)
i == 137 -> (x, y) == (1, 6)
i == 138 -> (x, y) == (0, 6)
i == 139 -> (x, y) == (-1, 6)
i == 140 -> (x, y) == (-2, 6)
i == 141 -> (x, y) == (-3, 6)
i == 142 -> (x, y) == (-4, 6)
i == 143 -> (x, y) == (-5, 6)
i == 144 -> (x, y) == (-6, 6)
i == 145 -> (x, y) == (-6, 5)
i == 146 -> (x, y) == (-6, 4)
i == 147 -> (x, y) == (-6, 3)
i == 148 -> (x, y) == (-6, 2)
i == 149 -> (x, y) == (-6, 1)
i == 150 -> (x, y) == (-6, 0)
i == 151 -> (x, y) == (-6, -1)
i == 152 -> (x, y) == (-6, -2)
i == 153 -> (x, y) == (-6, -3)
i == 154 -> (x, y) == (-6, -4)
i == 155 -> (x, y) == (-6, -5)
i == 156 -> (x, y) == (-6, -6)
i == 157 -> (x, y) == (-5, -6)
i == 158 -> (x, y) == (-4, -6)
i == 159 -> (x, y) == (-3, -6)
i == 160 -> (x, y) == (-2, -6)
i == 161 -> (x, y) == (-1, -6)
i == 162 -> (x, y) == (0, -6)
i == 163 -> (x, y) == (1, -6)
i == 164 -> (x, y) == (2, -6)
i == 165 -> (x, y) == (3, -6)
i == 166 -> (x, y) == (4, -6)
i == 167 -> (x, y) == (5, -6)
i == 168 -> (x, y) == (6, -6)
```
